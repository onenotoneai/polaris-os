<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Polaris OS | 北极星系统 (Pro)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background-color: #1a2332; color: #e5e7eb; -webkit-tap-highlight-color: transparent; }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        /* 隐藏滚动条但保留功能 */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        polaris: { bg: '#1a2332', gold: '#d4af37', danger: '#dc2626', surface: '#232d3f' }
                    }
                }
            }
        }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { Shield, Activity, Map, Plus, Trash2, ChevronRight, Save, History } = lucide;

        // --- 数据持久化 Hook ---
        const useStickyState = (defaultValue, key) => {
            const [value, setValue] = useState(() => {
                const stickyValue = window.localStorage.getItem(key);
                return stickyValue !== null ? JSON.parse(stickyValue) : defaultValue;
            });
            useEffect(() => {
                window.localStorage.setItem(key, JSON.stringify(value));
            }, [key, value]);
            return [value, setValue];
        };

        const App = () => {
            const [view, setView] = useState('home');
            // 真正的本地数据库：保存扫描记录
            const [scans, setScans] = useStickyState([], 'polaris_scans_v1');

            const addScan = (scan) => {
                const newScan = { ...scan, id: Date.now(), date: new Date().toLocaleDateString() };
                setScans([newScan, ...scans]);
            };

            const deleteScan = (id) => {
                setScans(scans.filter(s => s.id !== id));
            };

            return (
                <div className="min-h-screen flex flex-col max-w-md mx-auto bg-polaris-bg border-x border-white/5 shadow-2xl relative">
                    {/* 顶部导航 */}
                    <div className="h-14 flex items-center justify-between px-4 border-b border-white/10 bg-polaris-bg/90 backdrop-blur sticky top-0 z-50">
                        <span className="font-serif font-bold text-polaris-gold text-lg tracking-wider cursor-pointer" onClick={() => setView('home')}>Polaris</span>
                        <div className="flex gap-4">
                            <button onClick={() => setView('home')} className={`p-2 rounded ${view === 'home' ? 'bg-white/10 text-white' : 'text-gray-500'}`}><Map size={20}/></button>
                            <button onClick={() => setView('history')} className={`p-2 rounded ${view === 'history' ? 'bg-white/10 text-white' : 'text-gray-500'}`}><History size={20}/></button>
                        </div>
                    </div>

                    {/* 内容区域 */}
                    <div className="flex-1 overflow-y-auto no-scrollbar pb-20 fade-in">
                        {view === 'home' && <Home setView={setView} recentScans={scans.slice(0,2)} />}
                        {view === 'scanner' && <Scanner onSave={addScan} onBack={() => setView('home')} />}
                        {view === 'history' && <HistoryView scans={scans} onDelete={deleteScan} />}
                    </div>
                </div>
            );
        };

        // --- 视图组件 ---
        const Home = ({ setView, recentScans }) => (
            <div className="p-6 space-y-8">
                <div className="text-center py-8">
                    <h1 className="text-4xl font-serif text-white mb-2">Decision OS</h1>
                    <p className="text-gray-500 text-sm">您的外部决策大脑</p>
                </div>

                <button onClick={() => setView('scanner')} className="w-full bg-gradient-to-r from-yellow-600 to-polaris-gold p-1 rounded-xl shadow-lg shadow-yellow-900/20 active:scale-95 transition-transform">
                    <div className="bg-polaris-bg rounded-lg p-5 flex items-center justify-between hover:bg-polaris-bg/80 transition-colors">
                        <div className="flex items-center gap-4">
                            <div className="bg-yellow-500/10 p-3 rounded-full text-polaris-gold"><Shield size={24}/></div>
                            <div className="text-left">
                                <div className="text-white font-bold text-lg">启动新扫描</div>
                                <div className="text-xs text-gray-400">WindowGuard Protocol</div>
                            </div>
                        </div>
                        <ChevronRight className="text-gray-500" />
                    </div>
                </button>

                <div>
                    <div className="flex justify-between items-end mb-4">
                        <h3 className="text-gray-400 text-xs font-mono uppercase tracking-wider">Recent Signals</h3>
                        <span className="text-xs text-polaris-gold">{recentScans.length} Records</span>
                    </div>
                    {recentScans.length === 0 ? (
                        <div className="text-center p-8 border border-dashed border-white/10 rounded-xl text-gray-600 text-sm">暂无扫描记录</div>
                    ) : (
                        <div className="space-y-3">
                            {recentScans.map(scan => <ScanCard key={scan.id} scan={scan} mini />)}
                        </div>
                    )}
                </div>
            </div>
        );

        const Scanner = ({ onSave, onBack }) => {
            const [step, setStep] = useState(1);
            const [form, setForm] = useState({ title: '', score: 0 });

            const finishScan = () => {
                // 简单的模拟算法
                const riskLevel = Math.random() > 0.5 ? 'HIGH' : 'MEDIUM';
                onSave({
                    title: form.title || '未命名项目',
                    risk: riskLevel,
                    desc: riskLevel === 'HIGH' ? '检测到不可逆结构，建议回避。' : '风险可控，但需注意权力归属。'
                });
                onBack();
            };

            return (
                <div className="p-6 min-h-full bg-polaris-bg">
                    <h2 className="text-2xl text-white font-serif mb-6">风险扫描</h2>
                    <div className="space-y-6">
                        <div>
                            <label className="text-xs text-polaris-gold mb-2 block uppercase">Target Name</label>
                            <input autoFocus className="w-full bg-polaris-surface border border-white/10 rounded p-4 text-white focus:border-polaris-gold outline-none" 
                                placeholder="输入机会名称..."
                                value={form.title}
                                onChange={e => setForm({...form, title: e.target.value})} 
                            />
                        </div>
                        
                        <div className="bg-polaris-surface p-4 rounded border border-white/5 space-y-4">
                            <p className="text-sm text-gray-300">1. 这件事有“复利”效应吗？</p>
                            <div className="flex gap-2">
                                <button className="flex-1 py-2 bg-white/5 hover:bg-white/10 rounded text-sm text-gray-400 hover:text-white transition">无</button>
                                <button className="flex-1 py-2 bg-white/5 hover:bg-white/10 rounded text-sm text-gray-400 hover:text-white transition">有</button>
                            </div>
                        </div>

                        <div className="bg-polaris-surface p-4 rounded border border-white/5 space-y-4">
                            <p className="text-sm text-gray-300">2. 退出成本高吗？</p>
                            <div className="flex gap-2">
                                <button className="flex-1 py-2 bg-white/5 hover:bg-white/10 rounded text-sm text-gray-400 hover:text-white transition">低</button>
                                <button className="flex-1 py-2 bg-white/5 hover:bg-white/10 rounded text-sm text-gray-400 hover:text-white transition">高</button>
                            </div>
                        </div>

                        <button onClick={finishScan} className="w-full bg-polaris-gold text-black font-bold py-4 rounded-xl mt-8 flex justify-center gap-2 items-center">
                            <Save size={18} /> 保存并生成报告
                        </button>
                        <button onClick={onBack} className="w-full py-4 text-gray-500 text-sm">取消</button>
                    </div>
                </div>
            );
        };

        const HistoryView = ({ scans, onDelete }) => (
            <div className="p-6">
                <h2 className="text-2xl text-white font-serif mb-6">Database</h2>
                <div className="space-y-4">
                    {scans.length === 0 && <p className="text-gray-500">空空如也。</p>}
                    {scans.map(scan => (
                        <div key={scan.id} className="relative group">
                            <ScanCard scan={scan} />
                            <button 
                                onClick={(e) => { e.stopPropagation(); onDelete(scan.id); }}
                                className="absolute top-4 right-4 text-gray-600 hover:text-red-500 p-2"
                            >
                                <Trash2 size={16} />
                            </button>
                        </div>
                    ))}
                </div>
            </div>
        );

        const ScanCard = ({ scan, mini }) => (
            <div className={`bg-polaris-surface border border-white/5 p-4 rounded-lg flex items-center gap-4 ${scan.risk === 'HIGH' ? 'border-l-4 border-l-red-600' : 'border-l-4 border-l-yellow-500'}`}>
                <div className={`p-2 rounded-full ${scan.risk === 'HIGH' ? 'bg-red-900/20 text-red-500' : 'bg-yellow-900/20 text-yellow-500'}`}>
                    <Activity size={mini ? 16 : 20} />
                </div>
                <div>
                    <div className="text-white font-medium text-sm">{scan.title}</div>
                    {!mini && <div className="text-xs text-gray-400 mt-1">{scan.desc}</div>}
                    <div className="text-[10px] text-gray-600 font-mono mt-1">{scan.date} • {scan.risk}</div>
                </div>
            </div>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
