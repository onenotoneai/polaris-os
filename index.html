<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Polaris OS | 北极星系统 (Stable)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React 核心 -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel 编译器 -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { background-color: #1a2332; color: #e5e7eb; -webkit-tap-highlight-color: transparent; }
        /* 简单的加载动画 */
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        polaris: { bg: '#1a2332', gold: '#d4af37', surface: '#232d3f' }
                    }
                }
            }
        }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- 1. 内置图标组件 (防止外部库报错) ---
        const Icons = {
            Map: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon><line x1="8" y1="2" x2="8" y2="18"></line><line x1="16" y1="6" x2="16" y2="22"></line></svg>,
            Shield: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>,
            History: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 3v5h5"></path><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"></path><path d="M12 7v5l4 2"></path></svg>,
            ChevronRight: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>,
            Trash: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>,
            Save: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
        };

        // --- 2. 数据存储逻辑 ---
        const useStickyState = (defaultValue, key) => {
            const [value, setValue] = useState(() => {
                try {
                    const stickyValue = window.localStorage.getItem(key);
                    return stickyValue !== null ? JSON.parse(stickyValue) : defaultValue;
                } catch (e) { return defaultValue; }
            });
            useEffect(() => {
                window.localStorage.setItem(key, JSON.stringify(value));
            }, [key, value]);
            return [value, setValue];
        };

        // --- 3. 主程序 ---
        const App = () => {
            const [view, setView] = useState('home');
            const [scans, setScans] = useStickyState([], 'polaris_v3_data');

            const addScan = (data) => {
                const newScan = { ...data, id: Date.now(), date: new Date().toLocaleDateString() };
                setScans([newScan, ...scans]);
                setView('home');
            };

            const deleteScan = (id) => {
                if(confirm('确定删除这条记录吗？')) {
                    setScans(scans.filter(s => s.id !== id));
                }
            };

            return (
                <div className="min-h-screen flex flex-col max-w-md mx-auto bg-polaris-bg border-x border-white/5 shadow-2xl relative font-sans">
                    {/* 顶栏 */}
                    <div className="h-16 flex items-center justify-between px-6 border-b border-white/10 bg-polaris-bg/95 backdrop-blur sticky top-0 z-50">
                        <span className="font-bold text-polaris-gold text-xl tracking-wider cursor-pointer" onClick={() => setView('home')}>POLARIS</span>
                        <div className="flex gap-4">
                            <NavBtn icon={<Icons.Map />} active={view === 'home'} onClick={() => setView('home')} />
                            <NavBtn icon={<Icons.History />} active={view === 'history'} onClick={() => setView('history')} />
                        </div>
                    </div>

                    {/* 页面内容 */}
                    <div className="flex-1 overflow-y-auto p-4 fade-in">
                        {view === 'home' && <Home setView={setView} recentScans={scans} />}
                        {view === 'scanner' && <Scanner onSave={addScan} onCancel={() => setView('home')} />}
                        {view === 'history' && <HistoryList scans={scans} onDelete={deleteScan} />}
                    </div>
                </div>
            );
        };

        const NavBtn = ({ icon, active, onClick }) => (
            <button onClick={onClick} className={`p-2 rounded-lg transition-all ${active ? 'text-polaris-gold bg-white/10' : 'text-gray-500 hover:text-white'}`}>
                {icon}
            </button>
        );

        // --- 首页视图 ---
        const Home = ({ setView, recentScans }) => (
            <div className="space-y-8 pt-4">
                <div className="text-center space-y-2">
                    <h1 className="text-3xl text-white font-light">Decision OS</h1>
                    <p className="text-gray-500 text-sm">外部决策辅助系统</p>
                </div>

                <div 
                    onClick={() => setView('scanner')}
                    className="bg-gradient-to-r from-yellow-700/50 to-polaris-gold/20 p-[1px] rounded-xl cursor-pointer active:scale-95 transition-transform"
                >
                    <div className="bg-polaris-surface rounded-xl p-6 flex items-center justify-between hover:bg-white/5 transition">
                        <div className="flex items-center gap-4">
                            <div className="text-polaris-gold bg-yellow-500/10 p-3 rounded-full"><Icons.Shield /></div>
                            <div>
                                <div className="text-white font-bold text-lg">开始扫描</div>
                                <div className="text-xs text-gray-400">WindowGuard Protocol</div>
                            </div>
                        </div>
                        <div className="text-gray-500"><Icons.ChevronRight /></div>
                    </div>
                </div>

                <div>
                    <div className="flex justify-between items-end mb-4 px-1">
                        <h3 className="text-gray-400 text-xs font-bold uppercase tracking-widest">最新信号</h3>
                        <span className="text-xs text-polaris-gold font-mono">{recentScans.length} 条记录</span>
                    </div>
                    {recentScans.length === 0 ? (
                        <div className="text-center py-10 border border-dashed border-white/10 rounded-xl text-gray-600 text-sm">
                            暂无数据，请点击上方按钮开始扫描
                        </div>
                    ) : (
                        <div className="space-y-3">
                            {recentScans.slice(0, 3).map(scan => <ScanCard key={scan.id} scan={scan} />)}
                        </div>
                    )}
                </div>
            </div>
        );

        // --- 扫描器视图 ---
        const Scanner = ({ onSave, onCancel }) => {
            const [form, setForm] = useState({ title: '', axis1: '', axis2: '' });

            return (
                <div className="space-y-6 pt-2">
                    <h2 className="text-2xl text-white font-light">风险评估</h2>
                    
                    <div className="space-y-4">
                        <InputGroup label="目标名称" value={form.title} onChange={v => setForm({...form, title: v})} ph="例如：跳槽去 A 公司" />
                        <InputGroup label="轴心一：是否缓慢恶化？" value={form.axis1} onChange={v => setForm({...form, axis1: v})} ph="随着时间推移，价值会降低吗？" area />
                        <InputGroup label="轴心二：是否存在不可逆点？" value={form.axis2} onChange={v => setForm({...form, axis2: v})} ph="一旦做了，还能回头吗？" area />
                    </div>

                    <div className="grid grid-cols-2 gap-4 pt-4">
                        <button onClick={onCancel} className="py-3 rounded-lg border border-white/10 text-gray-400 hover:text-white">取消</button>
                        <button 
                            onClick={() => {
                                if(!form.title) return alert('请输入名称');
                                const isHighRisk = form.axis2.length > 5; // 简单的模拟判断
                                onSave({ 
                                    title: form.title, 
                                    risk: isHighRisk ? 'HIGH' : 'LOW', 
                                    desc: isHighRisk ? '检测到结构性风险' : '初步评估通过' 
                                });
                            }}
                            className="py-3 rounded-lg bg-polaris-gold text-black font-bold hover:bg-yellow-500 flex justify-center items-center gap-2"
                        >
                            <Icons.Save /> 保存
                        </button>
                    </div>
                </div>
            );
        };

        // --- 历史记录视图 ---
        const HistoryList = ({ scans, onDelete }) => (
            <div className="space-y-4 pt-2">
                <h2 className="text-2xl text-white font-light mb-6">数据库</h2>
                {scans.length === 0 && <p className="text-gray-500 text-center py-10">空空如也</p>}
                {scans.map(scan => (
                    <div key={scan.id} className="relative group">
                        <ScanCard scan={scan} />
                        <button 
                            onClick={() => onDelete(scan.id)}
                            className="absolute top-4 right-4 text-gray-600 hover:text-red-500 p-2 bg-polaris-bg rounded-full border border-white/5"
                        >
                            <Icons.Trash />
                        </button>
                    </div>
                ))}
            </div>
        );

        // --- 通用组件 ---
        const InputGroup = ({ label, value, onChange, ph, area }) => (
            <div>
                <label className="text-xs text-polaris-gold mb-1.5 block uppercase font-bold tracking-wide">{label}</label>
                {area ? (
                    <textarea 
                        className="w-full bg-polaris-surface border border-white/10 rounded-lg p-3 text-white focus:border-polaris-gold outline-none transition h-24"
                        placeholder={ph} value={value} onChange={e => onChange(e.target.value)}
                    ></textarea>
                ) : (
                    <input 
                        className="w-full bg-polaris-surface border border-white/10 rounded-lg p-3 text-white focus:border-polaris-gold outline-none transition"
                        placeholder={ph} value={value} onChange={e => onChange(e.target.value)}
                    />
                )}
            </div>
        );

        const ScanCard = ({ scan }) => (
            <div className={`bg-polaris-surface border p-4 rounded-lg flex items-start gap-3 ${scan.risk === 'HIGH' ? 'border-red-900/50 border-l-4 border-l-red-500' : 'border-white/5 border-l-4 border-l-green-500'}`}>
                <div className="flex-1">
                    <div className="text-white font-medium text-base mb-1">{scan.title}</div>
                    <div className="text-xs text-gray-400 mb-2">{scan.desc}</div>
                    <div className="flex gap-2">
                        <span className="text-[10px] bg-white/5 px-2 py-1 rounded text-gray-500 font-mono">{scan.date}</span>
                        <span className={`text-[10px] px-2 py-1 rounded font-mono font-bold ${scan.risk === 'HIGH' ? 'bg-red-900/30 text-red-400' : 'bg-green-900/30 text-green-400'}`}>
                            {scan.risk}
                        </span>
                    </div>
                </div>
            </div>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
